# 闭包（js终极难度）

## 如何产生闭包？

当一个嵌套的内部(子)函数引用了嵌套的外部(父)函数的变量(函数)时，就产生了闭包。



MDN:一个函数和对其周围状态（**lexical environment，词法环境**）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是**闭包**（**closure**）。

## 闭包的生命周期

闭包的产生： 在嵌套内部函数定义执行完成时就产生了(不是在调用)

闭包的死亡：在嵌套的内部函数成为垃圾对象时

## 闭包到底是啥？

理解一：闭包是嵌套的内部函数

理解二：包含被引用变量(函数)的**对象**



注意：闭包存在与嵌套的内部函数中

## 产生闭包的条件

1. 函数嵌套
2. 内部函数引用了外部函数的数据(变量/函数)
3. 外部函数被调用(和函数提升有关)



## 闭包的作用

1. 使函数内部的变量在函数执行完后，仍然存活在内存中(延长了局部变量的生命周期)
2. 让函数外部可以**间接**操作(读写)到函数内部的数据(变量/函数)

## 闭包的个数

**看外部函数调用了几次**

## 闭包的应用：定义JS模块

js模块是具有特定功能的js文件

将所有的数据和功能封装在一个函数内部(**私有的**)

只向外暴露一个包含n个方法的对象或者函数

模块的使用者，只需要通过模块暴露的对象调用方法来实现对应的功能

## 闭包的缺点

1. 函数执行完毕后，函数内的局部变量没有释放，占用内存时间会边长

2. 容易造成内存泄漏

解决方式：

* 能不用闭包就别用
* 及时释放



## 函数执行完毕后，函数内部声明的局部变量是否还存在？

一般不存在，只有在闭包中的变量才可能存在

## 在函数内部能直接访问函数内部的局部变量吗？

不能，可以通过闭包让外部操作内部变量

