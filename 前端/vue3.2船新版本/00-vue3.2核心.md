# vue3.2æ ¸å¿ƒ

## *æœ€ä½³ç»„ä»¶é€»è¾‘å¤ç”¨æ–¹å¼ï¼š`Composables`

å…¶å®ï¼šåƒä¸‹é¢çš„`ref`å‘€ã€`watch`å‘€éƒ½æ˜¯`composables`ã€‚

æ— æ•Œå•Šè¿™ä¸ªï¼šç›´æ¥èƒ½æŠŠé€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œæ— æ•Œäº†ã€‚

æ›¿ä»£`vue2`ä¸­çš„`Mixin`ä½†æ˜¯æ¯”`Mixin`å¼ºå¤šäº†

* `composable`æ˜¯ä¸€ä¸ªæ™®é€šçš„jså‡½æ•°
* setup()ä¸­çš„ä»£ç å…¨éƒ¨éƒ½å¯ä»¥åœ¨`composables`ä¸­ç¼–å†™
* `composables`**é€»è¾‘è¶Šç‹¬ç«‹è¶Šå¥½**
* èƒ½å‡å°‘ç»„ä»¶æ–‡ä»¶çš„ä»£ç ï¼Œå¢å¼ºå¤ç”¨æ€§

>ç¬¬ä¸€æ­¥ï¼šåœ¨srcä¸‹åˆ›å»º`composables`æ–‡ä»¶å¤¹

>ç¬¬äºŒæ­¥ï¼šæ–°å»ºä¸€ä¸ªuseListData.jsæ–‡ä»¶
>
>æ³¨æ„ï¼š`composables`æ–‡ä»¶å»ºè®®ä»¥useå¼€å¤´



>ç¬¬ä¸‰æ­¥ï¼šä¹¦å†™å…¬ç”¨ä»£ç 

`useListData.js`ï¼šåˆ›å»ºdataï¼Œå¹¶æœ‰ä¸€ä¸ªåˆ é™¤å‡½æ•°

```js
import { ref } from 'vue';

function useListData(data) {
	const dataRef = ref(data);

	function removeItem(id) {
		dataRef.value = dataRef.value.filter(data => {
			return data.id !== id;
		});
	}

	return { data: dataRef, removeItem };
}

export default useListData;

```



>ç¬¬å››æ­¥ï¼šä½¿ç”¨

`MessageList.vue`ç»„ä»¶ï¼š

```vue
<template>
	<ul>
		<li v-for="item in messagesList" :key="item.id">
			{{ item.name }}
			<button @click="removeMessageItem(item.id)">Remove</button>
		</li>
	</ul>
</template>
<script>
import useListData from '../composables/useListData';
export default {
	setup() {
    // è¿™é‡Œè°ƒç”¨composableså¹¶ç»“æ„å‡ºæ¥
		const { data: messagesList, removeItem: removeMessageItem } = useListData([
			{
				id: 1,
				name: 'é’±ä¸äºŒ'
			},
			{
				id: 2,
				name: 'é’±æŸäºº'
			}
		]);
		console.log(messagesList.value);
		return { messagesList, removeMessageItem };
	}
};
</script>

```





## setupçš„è¯­æ³•ç³–

è¯¥è¯­æ³•ç³–ï¼šåœ¨vue3.2ä¸­æ‰èƒ½ä½¿ç”¨

![08-setupè¯­æ³•ç³–](../../å‰ç«¯å›¾ç‰‡/vue3.2/08-setupè¯­æ³•ç³–.PNG)

1ï¼‰ä¸‹é¢çš„`API`(æˆ–è€…å«`composables`)ä¾‹å¦‚`ref`ã€`reactive`ã€`watch`ã€`computed`ç­‰è¿˜æœ‰ç”Ÿå‘½å‘¨æœŸé’©å­ç›´æ¥å†™ã€‚



2ï¼‰å¹¶ä¸”æ¨¡æ¿ä¸­èƒ½ç›´æ¥ä½¿ç”¨<script setup>ä¸­å®šä¹‰çš„å˜é‡ä¸å‡½æ•°å¦‚ä¸‹å›¾ï¼š

<img src="../../å‰ç«¯å›¾ç‰‡/vue3.2/09-setupè¯­æ³•ç³–2.PNG" alt="09-setupè¯­æ³•ç³–2" style="zoom:150%;" />



3ï¼‰ç”±äºæ— æ³•ä½¿ç”¨componentsé…ç½®é¡¹ï¼Œå¼•å…¥çš„ç»„ä»¶å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ— æ•ŒğŸ‘

![08-setupè¯­æ³•ç³–3](../../å‰ç«¯å›¾ç‰‡/vue3.2/08-setupè¯­æ³•ç³–3.PNG)



### `<script setup>`å®šä¹‰props

æ³¨æ„ï¼šé»˜è®¤å°±æœ‰`defineProps`ï¼Œä¸éœ€è¦æˆ‘ä»¬`import`

ç”±äºè¯­æ³•ç³–å†™æ³•ï¼Œå°±ä¸èƒ½å†™`props`é…ç½®é¡¹äº†ï¼Œé€šè¿‡`defineProps`æ¥è·å–ï¼Œå®ƒæ¥æ”¶å’Œ`props`é…ç½®é¡¹ä¸€æ ·çš„å‚æ•°

ç¤ºä¾‹ï¼š

```vue
<template>
	<!--æ¨¡æ¿ä¸­çš„ä½¿ç”¨æ–¹å¼ä¸å˜-->
	<p>
    {{title}}
  </p>
</template>
<script setup>
  const props = defineProps(['title', 'name'])
  
  
  // åœ¨setupä¸­è®¿é—®propsï¼Œå¯ä»¥æ¥æ”¶definePropsçš„å€¼
  console.log(props.title);
</script>
```





### `<script setup>`å®šä¹‰emits

æ³¨æ„ï¼šé»˜è®¤å°±æœ‰`defineEmits`ï¼Œä¸éœ€è¦æˆ‘ä»¬`import`

ç”±äºè¯­æ³•ç³–å†™æ³•ä¹Ÿä¸èƒ½ä½¿ç”¨emitsé…ç½®é¡¹ï¼Œé€šè¿‡

`defineEmits`apiæ¥æ¥æ”¶`emits`ã€‚

ç¤ºä¾‹ï¼š

```vue
<template>
	<!--æ¨¡æ¿ä¸­è§¦å‘ä¸å˜-->
	<button @click="$emit('remove')">
    ç‚¹æˆ‘
  </button>
</template>
<script setup>
  const emit = defineEmits(['click', 'remove']);
  
  // setupä¸­ä½¿ç”¨,é€šè¿‡defineEmitsçš„è¿”å›å€¼
  function handleClick() {
    emit('click')
  }
</script>
```



### `<script setup>`ä¸­çš„slotså’Œattrs

å¯¹äºsetup(props,  context)å‡½æ•°ä¸­çš„`context.slots`å’Œ`context.attrs`æœ‰ä»¥ä¸‹ä¿©apiï¼š

![08-setupè¯­æ³•ç³–4](../../å‰ç«¯å›¾ç‰‡/vue3.2/08-setupè¯­æ³•ç³–4.PNG)



# å„ç§`composables`

## setup()

setupå‡½æ•°ä½œä¸ºå¼€å§‹çš„èµ·ç‚¹ã€‚

è¯­æ³•ï¼š

```vue
<template>
	...
</template>
<script>
  // æ³¨æ„setupä¸­è¿”å›çš„ç»“æœï¼Œå¯ä»¥ç›´æ¥åœ¨templateä¸­ä½¿ç”¨
	setup() {
    return {
      xxx
    }
  }
</script>
```



## toRefs()å‡½æ•°

toRefså‡½æ•°çš„ä½œç”¨ï¼Œæ˜¯å°†ä¸€ä¸ªéå“åº”å¼çš„å¯¹è±¡è½¬æ¢æˆä¸€ä¸ªå“åº”å¼çš„å¯¹è±¡ã€‚

ç¤ºä¾‹ï¼š

```vue
<script>
	setup(props) {
    // å°†propså¯¹è±¡ï¼ŒåŒ…è£…ä¸ºå“åº”å¼å¯¹è±¡
    const {title} = toRefs(props);
  }
</script>
```

### toRef()å‡½æ•°

toRef()å‡½æ•°èƒ½å¤Ÿå°†ä¸€ä¸ªå¯¹è±¡ä¸­çš„æŸä¸ªå€¼è½¬æ¢æˆå“åº”å¼æ•°æ®

è¯­æ³•ï¼š

```js
toRef(å¯¹è±¡, å±æ€§å)
```





ç¤ºä¾‹ï¼š

```vue
<script>
	setup(props) {
    // å°†propsä¸‹çš„titleå±æ€§åŒ…è£…æˆå“åº”å¼çš„
    const title = toRef(props, 'title');
  }
</script>
```



## ref()å‡½æ•°

ref(å‚æ•°)å‡½æ•°æ¥æ”¶ä¸€ä¸ªä»»æ„ç±»å‹çš„å‚æ•°ï¼Œä¼šå°†å‚æ•°åŒ…è£…æˆå“åº”å¼æ•°æ®ç„¶åè¿”å›ã€‚

ä½œç”¨ï¼šç”¨æ¥æ›¿ä»£`data`é…ç½®é¡¹

è¯­æ³•ï¼š

```vue
<template>
	<p>
    <!--æ³¨æ„ï¼šæ¨¡æ¿ä¸­ä¸éœ€è¦.valueæ¥è®¿é—®-->
    {{num}}
  </p>
</template>
<script>
	import {ref} from 'vue';
  setup() {
    let str = 'å­—ç¬¦ä¸²';
		const num = ref(0);
    const s= ref( str);
    
    // è®¿é—®æ•°æ®
    num.value
    
    // æ³¨æ„å“åº”å¼æ•°æ®å’ŒåŸå§‹æ•°æ®ä¸ç›¸ç­‰
    str === s.value; // false
    
    return {num}
  }
</script>
```



## reactive()å‡½æ•°

reactiveå‡½æ•°å’Œrefå‡½æ•°ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒåªæ¥å—ä¸€ä¸ªå¯¹è±¡ç±»å‹çš„æ•°ç»„ï¼Œä¹Ÿæ˜¯å°†å‚æ•°åŒ…è£…æˆå“åº”å¼ç„¶åè¿›è¡Œè¿”å›ã€‚

è¯­æ³•ï¼š

```vue
<template>
	<p>
    {{obj.a}}
  </p>
</template>

<script>
import {reactive} from 'vue';
setup() {
  const obj = reactive({a: 1, b: 2});
  const arr = reactive([1, 2, 3, 4]);
  
  
  return {obj}
}
</script>
```



ä½œç”¨ï¼šå’Œrefç›¸æ¯”ï¼Œreactiveé€‚åˆåœ¨ä¸€æ¬¡æ€§å®šä¹‰å¤§é‡æ•°æ®çš„åœ°æ–¹ä½¿ç”¨ï¼Œä¾‹å¦‚è¡¨å•æ•°æ®ã€‚**è€Œä¸”reactiveå®šä¹‰çš„æ•°æ®ä¸éœ€è¦`.value`æ¥è®¿é—®**ï¼ˆå½“ç„¶æˆ‘ä»¬å¯ä»¥ç›´æ¥refä¸€æŠŠæ¢­ä¸€ğŸ¤£ï¼‰



## computed()å‡½æ•°

computedå‡½æ•°ç”¨æ¥å®šä¹‰è®¡ç®—å±æ€§ï¼Œå®ƒå°±æ˜¯ç”¨æ¥æ›¿ä»£`computed`é…ç½®é¡¹çš„ã€‚

è¯­æ³•ï¼š

```vue
<template>


</template>
<script>
	import {computed} from 'vue';
  setup() {
    // computedå‡½æ•°æ¥æ”¶ä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„å›è°ƒ
    const search = computed(() => {
      return .....;
    })
    
    // è®¿é—®ä¹Ÿéœ€è¦.value
    console.log(search.value);
    
    return {search}
  }
</script>
```

æ³¨æ„ï¼šcomputedå’Œrefå®šä¹‰å‡ºçš„æ•°æ®ï¼Œåœ¨è®¿é—®æ–¹å¼ä¸Šæ˜¯ä¸€æ ·çš„ã€‚



## watch()å‡½æ•°

watchå‡½æ•°ç”¨æ¥æ›¿ä»£vue2ä¸­çš„`watch`é…ç½®é¡¹

watchå‡½æ•°çš„ä½¿ç”¨æœ‰å¾ˆå¤šæ³¨æ„é¡¹ï¼Œæˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹æ¥çœ‹ã€‚

### ç¬¬ä¸€ç§ï¼šç›‘å¬æ™®é€šæ•°æ®ç±»å‹çš„`ref`

```vue
<script>
  import {watch} from 'vue';
	setup() {
    const searchTerm = ref("");
    
    // 1.ç›´æ¥ç›‘å¬ refè¿”å›çš„å€¼1
    watch(searchTerm, (newVal, oldVal) => {
      console.log('æ–°å€¼', newVal);
      console.log('æ—§å€¼', oldVal);
    })
    // è¿™ä¸¤ç§å†™æ³•åŠŸèƒ½ä¸€æ ·
    
    //2.ç›‘å¬.value éœ€è¦å†™æˆä¸€ä¸ªå›è°ƒæ–¹å¼ 
    watch(()=>searchTerm.value, (newVal, oldVal) => {
      console.log('æ–°å€¼', newVal);
      console.log('æ—§å€¼', oldVal);
    })
  }
</script>
```



### ç¬¬äºŒç§ï¼šç›‘å¬å¯¹è±¡ç±»å‹ä¸­çš„åŸºæœ¬ç±»å‹çš„`ref`

watch()å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦å†™æˆå›è°ƒå‡½æ•°å†™æ³•ã€‚

ç¤ºä¾‹ï¼š

```vue
<script>
  import {watch} from 'vue';
	setup() {
    const searchTerm = ref(
      {
        id: 1,
        name: 'é’±ä¸äºŒ'
      }
    );
    
    
    //ç›‘å¬å¯¹è±¡å±æ€§ï¼Œéœ€è¦å†™æˆä¸€ä¸ªå›è°ƒæ–¹å¼ 
    watch(()=>searchTerm.value.name, (newVal, oldVal) => {
      console.log('æ–°å€¼', newVal);
      console.log('æ—§å€¼', oldVal);
    })
  }
</script>
```



### ç¬¬ä¸‰ç§ï¼šç›´æ¥ç›‘å¬æ•´ä¸ªå¯¹è±¡çš„ref

watch()å‡½æ•°ï¼Œéœ€è¦ä¼ é€’ç¬¬ä¸‰ä¸ªå‚æ•°ä½œä¸ºé…ç½®é¡¹ï¼Œå¼€å¯æ·±åº¦ç›‘è§†

ç¤ºä¾‹ï¼š

```vue
<script>
  import {watch} from 'vue';
	setup() {
    const searchTerm = ref(
      {
        id: 1,
        name: 'é’±ä¸äºŒ'
      }
    );
    
    
    //1.åªå•çº¯ç›‘å¬æ•´ä¸ªå¯¹è±¡ï¼Œå¯¹è¿”å›å€¼æ²¡æœ‰è¦æ±‚çš„æƒ…å†µ
    watch(()=>searchTerm.value, (newVal, oldVal) => {			
      // æ³¨æ„è¿™é‡Œä¸¤ä¸ªå€¼æ˜¯ä¸€æ ·çš„ï¼Œè™½ç„¶ç›‘å¬åˆ°äº†ä¿®æ”¹ï¼Œä½†æ˜¯å¯¹è±¡çš„å¼•ç”¨åœ°å€å€¼æ²¡æ”¹å˜ï¼ŒnewVal === oldVal 
      console.log('æ–°å€¼', newVal);
      console.log('æ—§å€¼', oldVal);
    },
    {
      deep: true
    })
    
    
    // 2.å¦‚æœæƒ³è¦è·å–newValå’ŒoldValçš„æ”¹å˜ï¼Œéœ€è¦å°†ç¬¬ä¸€ä¸ªå‚æ•°è¿”å›çš„å¯¹è±¡è¿›è¡Œæ·±å…‹éš†ï¼Œæ·±å…‹éš†å¯ä»¥ä½¿ç”¨lodashåº“æˆ–è€…è‡ªå·±å°è£…
    watch(()=>JSON.parse(JSON.strigfy(searchTerm.value)), (newVal, oldVal) => {			
      // æ­¤æ—¶ï¼ŒnewValå’ŒoldValå°±æ˜¯ä¸¤ä¸ªä¸åŒçš„å€¼
      console.log('æ–°å€¼', newVal);
      console.log('æ—§å€¼', oldVal);
    },
    {
      deep: true
    })
  }
</script>
```

æ³¨æ„:**ä¸Šé¢æ–¹æ³•2ï¼šwatch()å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªå›è°ƒï¼Œå›è°ƒçš„è¿”å›å€¼ï¼Œå¿…é¡»æ˜¯æ·±å…‹éš†çš„ä¸€ä¸ªå¯¹è±¡ã€‚**



### ç¬¬å››ç§ï¼šåŒæ—¶ç›‘å¬å¤šä¸ªæ•°å€¼

å¯ä»¥å°†ç¬¬ä¸€ä¸ªå‚æ•°å†™æˆä¸€ä¸ªæ•°ç»„çš„å½¢å¼ã€‚

ç¤ºä¾‹ï¼š

```vue
<script>
  import {watch} from 'vue';
	setup() {
    const searchTerm = ref(
      {
        id: 1,
        name: 'é’±ä¸äºŒ'
      }
    );
    
    
    //ç¬¬ä¸€ä¸ªå‚æ•°å†™æˆä¸€ä¸ªæ•°ç»„å½¢å¼
    watch([
      ()=>searchTerm.value.name,
      ()=>searchTerm.value.id
    ], (newVal, oldVal) => {
      console.log('æ–°å€¼', newVal);
      console.log('æ—§å€¼', oldVal);
    })
  }
</script>
```





## watchEffect()å‡½æ•°

wacthEffect()è·Ÿwatch()çš„ä½œç”¨åŸºæœ¬ä¸€æ ·ï¼Œç”¨äºç›‘å¬å“åº”æ€§æ•°æ®çš„å˜åŒ–ï¼Œå¹¶æ ¹æ®å˜åŒ–åšå‡ºä¸€äº›ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚è¯·æ±‚è¿œç¨‹æœåŠ¡æ•°æ®ã€‚

è¯­æ³•ï¼š

```js
import {watchEffect,ref} from 'vue'
const options = ref({
  title: '1',
  name: '2'
})

watchEffect(() => {
  // ä¸€æ—¦å›è°ƒå‡½æ•°ä¸­çš„å€¼æœ‰å˜åŒ–ï¼Œè¯¥å›è°ƒå°±ä¼šé‡æ–°æ‰§è¡Œä¸€æ¬¡
  console.log(options.value.title)
  console.log(options.value.name)
})
```

æ³¨æ„ï¼š**watchEffect()å‡½æ•°åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ä¼šè°ƒç”¨ç¬¬ä¸€æ¬¡**ï¼Œéšåæ ¹æ®å›è°ƒå‡½æ•°ä¸­çš„å€¼å†³å®šè°ƒç”¨æ¬¡æ•°

ä½¿ç”¨åœºæ™¯ï¼š

![06-watchEffect](../../å‰ç«¯å›¾ç‰‡/vue3.2/06-watchEffect.PNG)

åƒåˆ†é¡µåŠŸèƒ½ï¼Œå°±å¯ä»¥ä½¿ç”¨watchEffect()



## watchEffectå’Œwatchæ”¶å°¾å·¥ä½œ

watchEffectçš„æ”¶å°¾å·¥ä½œï¼š

```js
watchEffect((onInvalidate)=> {
  onInvalidate(() => {
    console.log('åšä¸€äº›æ”¶å°¾å·¥ä½œ...');
  })
})
```

watchçš„æ”¶å°¾å·¥ä½œï¼š

```js
watch(
	()=>options.value.title,
  (newVal, oldVal, onInvalidate) => {
			onInvalidate(() => {
        console.log('åšä¸€äº›æ”¶å°¾å·¥ä½œ...');
      })
  }
)
```

æ³¨æ„ï¼š**onInvalidate()ä¼šåœ¨ä¸‹æ¬¡ç›‘å¬ä»£ç æ‰§è¡Œåæ‰§è¡Œ**

ç®€å•æ¥è¯´ï¼šå°±æ˜¯ç¬¬ä¸€æ¬¡ç›‘å¬åˆ°æ•°æ®æ”¹å˜`onInvalidate()`ä¸ä¼šæ‰§è¡Œï¼Œç¬¬äºŒæ¬¡ç›‘å¬åˆ°æ•°æ®æ”¹å˜åæ‰§è¡Œ`onInvalidate()`



## setup()ä¸­è®¿é—®props

æ¥æ”¶propsçš„æ–¹å¼å’Œä¹‹å‰ä¸€æ ·é€šè¿‡`props:['xxx']`

è€Œåœ¨setup()å‡½æ•°ä¸­é€šè¿‡æ¥æ”¶propså‚æ•°ï¼Œè€Œè¿›è¡Œè®¿é—®ï¼š

ç¤ºä¾‹ï¼š

```js
props: ['name']
setup(props) {
  console.log(props.name);
}
```



## å°†æ™®é€špropsæ•°æ®è½¬æ¢ä¸ºå“åº”å¼çš„(toRefs)

æˆ‘çš„å»ºè®®æ˜¯ï¼šä¼ é€’çš„propså¦‚æœä½¿ç”¨è§£æ„èµ‹å€¼è¯­æ³•ä»propsä¸­å–å€¼ï¼Œéƒ½è¦ç”¨`toRefs()`åŒ…è£¹ä¸€ä¸‹`props`

ç¤ºä¾‹ï¼š

```js
const {xx} = toRefs(props)
```





å¦‚æœï¼šåœ¨setupå‡½æ•°æ¥æ”¶çš„`props`å¯¹è±¡ï¼Œæ•´ä½“æ˜¯ä¸€ä¸ªå“åº”å¼çš„å¯¹è±¡ã€‚æƒ³è¦ç›‘å¬æ—¶éœ€è¦é€šè¿‡`props.value.xxx`æ¥ç›‘å¬ï¼Œå¦‚æœä½¿ç”¨äº†**è§£æ„èµ‹å€¼è¯­æ³•**é‚£ä¹ˆå°±ä¼šä¸¢å¤±å“åº”æ€§ï¼Œéœ€è¦`toRefs`æ¥åŒ…è£…ã€‚

æ³¨æ„ï¼š**å¦‚æœä½¿ç”¨ç»“æ„èµ‹å€¼è¯­æ³•ï¼Œè¦ä½¿ç”¨`toRefs`**

è§£å†³åŠæ³•ï¼šä½¿ç”¨`toRefs()`å‡½æ•°

ç¤ºä¾‹ï¼š

```vue
<--!çˆ¶ç»„ä»¶-->
<Item title='æ ‡é¢˜' />

  // å­ç»„ä»¶
<script>
	import { toRefs } from 'vue';
  props:['title']
  setup(props) {
    // è¿™ä¹Ÿpropså°±ä¼šå˜ä¸ºå“åº”å¼çš„äº†
    const {titlel} = toRefs(props);
  }
</script>
```



å¦‚æœï¼šçˆ¶ç»„ä»¶åœ¨ä¼ é€’æ•°æ®æ—¶ï¼Œ**ä¼ é€’çš„æ˜¯å“åº”æ€§æ•°æ®**(ç”¨refæˆ–reactiveä¿®é¥°è¿‡çš„)é‚£ä¹ˆä¼ é€’åˆ°**å­ç»„ä»¶ä¸­çš„propsä¹Ÿæ˜¯å“åº”æ€§æ•°æ®ã€‚**

æ³¨æ„ï¼šä½¿ç”¨è§£æ„èµ‹å€¼ä»»ç„¶æœ‰å“åº”æ€§çš„ï¼ˆåªæœ‰å¯¹è±¡å’Œæ•°ç»„ç±»å‹çš„å¯ä»¥ï¼ŒåŸºæœ¬ç±»å‹è¿˜æ˜¯è¦ç”¨toRefsåŒ…è£¹ä¸€ä¸‹ï¼‰



## è‡ªå®šä¹‰äº‹ä»¶(emit)

ç”±äºsetupå‡½æ•°ä¸­æ²¡æœ‰thisï¼Œæ‰€ä»¥æ— æ³•é€šè¿‡thisè®¿é—®æ¥æ”¶åˆ°çš„`emits:['customEvent']`ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡setup()ç¬¬äºŒä¸ªå‚æ•°è®¿é—®åˆ°ã€‚

ç¤ºä¾‹ï¼š

```vue
<template>
	<div @click="$emit('customEvent')">
    æ¨¡æ¿ä¸­ä½¿ç”¨çš„æ–¹å¼æ²¡æœ‰æ”¹å˜
  </div>
</template>

<script>
	emits:['customEvent'],
  setup(props, context) {
    // è°ƒç”¨é€šè¿‡context.emitæ¥è§¦å‘
    context.emit('customEvent');
  }
</script>
```



## ç”Ÿå‘½å‘¨æœŸé’©å­

å’Œvue2ä¸­çš„åŒºåˆ«ï¼Œç”Ÿå‘½å‘¨æœŸå‰é¢éƒ½åŠ ä¸Šäº†`on`ã€‚å¹¶ä¸”éƒ½å˜æˆäº†è¦ç»™å‡½æ•°ã€‚

![07-vue3.2ç”Ÿå‘½å‘¨æœŸ](../../å‰ç«¯å›¾ç‰‡/vue3.2/07-vue3.2ç”Ÿå‘½å‘¨æœŸ.PNG)

![07-vue3.2ç”Ÿå‘½å‘¨æœŸ2](../../å‰ç«¯å›¾ç‰‡/vue3.2/07-vue3.2ç”Ÿå‘½å‘¨æœŸ2.PNG)

æ³¨æ„ï¼šç”±äº`setup`å‡½æ•°æ‰§è¡Œçš„å‘¨æœŸå°±æ˜¯åœ¨`beforeCreate`å’Œ`created`ä¹‹é—´ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸçš„é€»è¾‘ç›´æ¥å¸è½½`setup`å‡½æ•°ä¸­å°±è¡Œã€‚



ä¾‹å¦‚ï¼š

```js
// mountedå˜ä¸º
onMounted(() => {
  // ä¸šåŠ¡ä»£ç 
})
```



## provideå’Œinjectçš„æ›¿ä»£

provideå’Œinjecté…ç½®é¡¹ï¼Œåœ¨vue2ä¸­æ˜¯ç”¨æ¥ç»™åµŒå¥—å¤šçº§çš„ç»„ä»¶ä¼ é€’æ•°æ®çš„ã€‚åœ¨vue3ä¸­ï¼Œè¿™ä¿©å˜æˆäº†ä¸¤ä¸ªå‡½æ•°ã€‚

ç¤ºä¾‹ï¼š**ä¼ é€’éå“åº”å¼æ•°æ®ã€‚**

```vue
<template>
	<!--æœ€å¤–å±‚ç»„ä»¶-->
	<Item />
</template>
<script>
	import { provide } from 'vue';
  setup() {
    const movie = {
      title: 'ç”µå½±'
    }
    // provideä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºå‚æ•°åï¼Œç¬¬äºŒä¸ªä¸ºå®é™…ä¼ é€’çš„å‚æ•°ã€‚
    provide(title, movie.title)
  }
</script>


<script>
  // æœ€å†…å±‚ç»„ä»¶
	import { inject } from 'vue';
  setup() {
    // æ¥æ”¶åˆ°provideä¼ é€’çš„title
    const title = inject('title');
    return {title};
  }
</script>
```



å¦‚æœæƒ³è¦ä¼ é€’å“åº”æ€§æ•°æ®ï¼šè¿˜æ˜¯æœ‰å“åº”å¼æ•°æ®çš„é€šç—…ï¼Œå»ºè®®ä½¿ç”¨toRefæˆ–è€…toRefså¤„ç†ä¸€ä¸‹

ç¤ºä¾‹ï¼š

```vue
<template>
	<!--æœ€å¤–å±‚ç»„ä»¶-->
	<Item />
</template>
<script>
	import { provide,refï¼ŒtoRef } from 'vue';
  setup() {
    const movie = ref({
      title: 'ç”µå½±'
    })
    // 1.ä¼ é€’æ•´ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥æ˜¯å“åº”æ€§çš„
    // provide(movie, movie.value)
    
    // 2.å¦‚æœä¼ é€’å¯¹è±¡ä¸­çš„ä¸€ä¸ªå€¼,è¿™ä¹Ÿå°±ä¼šä¸¢å¤±å“åº”æ€§(å“åº”å¼æ•°æ®ä¼ é€’çš„é€šç—…)éœ€è¦ä½¿ç”¨toRef
    // provide(title, movie.value.title);
    
    // 3.ä¸Šé¢ç¬¬äºŒæ¡çš„æ”¹è¿›ç‰ˆ,ä½¿ç”¨toRefåŒ…è£…ä¸€ä¸‹
    provide(title, toRef(movie.value, movie.value.title));
  }
</script>


<script>
  // æœ€å†…å±‚ç»„ä»¶
	import { inject } from 'vue';
  setup() {
    // æ¥æ”¶åˆ°provideä¼ é€’çš„title
    const title = inject('title');
    return {title};
  }
</script>
```



## è·å–templateä¸­çš„ref

é€šè¿‡`ref(null)`æ¥è·å–ï¼Œä½¿ç”¨çš„ä¹Ÿæ˜¯`ref()`å‡½æ•°ï¼Œå°±æ˜¯å‚æ•°è¦ä¼ é€’`null`ã€‚

è¯­æ³•ï¼š

```js
const xx = ref(null);
// è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªrefå¯¹è±¡ï¼Œéœ€è¦.value
```



ç¤ºä¾‹ï¼š

```vue
<template>
	<input type="text" ref="inputControl" />
</template>
<script>
import { onMounted, ref } from 'vue';
export default {
	setup() {
    // è·å–inputçš„dom
		const inputControl = ref(null);
		onMounted(() => {
			inputControl.value.focus();
			// console.log(inputControl);
		});

		return { inputControl };
	}
};
</script>

```



## contextçš„soltså±æ€§

è¯¥å±æ€§å’Œæ¸²æŸ“å‡½æ•°æœ‰å…³ï¼Œå¯ä»¥å»å®˜ç½‘çœ‹ä¸€çœ‹ã€‚

## contextçš„attrså±æ€§

contextæ˜¯setupå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚

attrså±æ€§ç”¨äºæ›¿æ¢vue2ä¸­çš„this.$attrsï¼ŒåŠŸèƒ½ä¸€è‡´éƒ½æ˜¯ä¸ºäº†è®¿é—®ï¼Œä¼ é€’ä½†æ²¡æœ‰æ¥æ”¶çš„`props`

ç¤ºä¾‹ï¼š

```vue
<template>
	<!--çˆ¶ç»„ä»¶-->
	<AutoFocus name="é’±ä¸äºŒ"></AutoFocus>
</template>



// å­ç»„ä»¶
<template>
	<input type="text" ref="inputControl" />
</template>
<script>
import { onMounted, ref } from 'vue';
export default {
	setup(props, { attrs }) {
    // é€šè¿‡attrsæ¥è®¿é—®name
		console.log(attrs);
	}
};
</script>

```

æ³¨æ„ï¼šattrså¯¹è±¡æœ¬èº«æ˜¯ç›¸åº”æ€§çš„ï¼Œä½†æ˜¯å®ƒé‡Œé¢çš„æ•°æ®ä¸æ˜¯ã€‚å®ƒä¹Ÿæœ‰å“åº”å¼æ•°æ®çš„é€šç—…ï¼Œæƒ³è¦æœ‰å“åº”å¼éœ€è¦`toRefs`æˆ–`toRef`





## setupä¸­çš„methods

åœ¨setupä¸­å‡½æ•°ç›´æ¥å®šä¹‰ï¼Œå®šä¹‰å®Œæ¯•ç›´æ¥returnï¼Œç„¶åæ¨¡æ¿å°±èƒ½ä½¿ç”¨