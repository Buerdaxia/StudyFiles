# 18-关于用户登录后持久话存储的方案





## 方案一（`vuex`+`storage`）

最常见也最简单的一般都是用的这种方案



分为以下几个步骤：

1. 在vuex的state中创建对应存储用户状态的变量例如`userInfo`，在mutations中创建登录方法login，初始化unserInfo方法，initUserInfo等等
2. 在mutations中login会借助storage来进行持久化存储
3. 初始化方法调用位置（一般都会选择在APP.vue的onLaunch方法中去调用一次来进行初始化）



示例：

```js
// vuex
export default {
  state: {
    // 登录状态
    loginStatus: false,
    
    // token
    token: null,
    
    // 用户信息
    userInfo: {}
  },
  
  mutations: {
    // 初始化登录状态
    initUser(state) {
      let userInfo = uni.getStorageSync('userInfo');
      if(userInfo) {
        state.userInfo = JSON.parse(userInfo);
        state.token = JSON.parse(userInfo).token;
        state.loginStatus = true;
      }
    },
    // 登录
    login(state, userInfo) {
      state.userInfo = userInfo;
      state.loginStatus = true;
      state.token = userInfo.token;
      uni.setStorageSync('userInfo', JSON.stringify(userInfo));
    },
    logout(state) {
      state.userInfo = {};
      state.loginStatus = false;
      state.token = null;
      uni.removeStorageSync('userInfo');
    }
  }
}
```



初始化方法的调用位置：`initUser(state)`

```vue
<script>
// App.js
  onLaunch: function() {
    console.log('App Launch')
    this.$store.commit('initUser');
	},
</script>
```

