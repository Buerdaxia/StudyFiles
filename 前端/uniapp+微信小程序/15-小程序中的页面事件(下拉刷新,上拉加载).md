# 小程序中的页面事件



## 下拉刷新

下拉刷新是移动端的专有名词，指的是通过手指在屏幕上的下拉滑动操作，从而**重新加载页面数据**的行为。



### 启动下拉刷新

下拉刷新有两种启动方式：

1）全局启动：

在app.json中的window节点中，配置`"enablePullDownRefresh": true`



2）局部启动：

在页面.json配置文件中，设置`"enablePullDownRefresh": true`



推荐：使用局部启动，为需要的页面单独开启下拉刷新

### 配置下拉刷新窗口的样式

俩个属性 `"backgroundColor": "#efefef"`和`"backgroundTextStyle": "dark"`

其中：`backgroundTextStyle`只能是`dark`或者`light`



### 监听页面的下拉刷新事件

在页面的`.js`文件中，通过`onPullDownRefresh()`函数可以监听当前页面的下拉刷新事件。

在这个监听函数中，就可以触发很多很多函数了，例如加载数据啊等等



### 停止下拉刷新效果

当处理完毕下拉刷新后，下拉刷新的loading效果会一直存在，不会主动消失，需要我们手动的去关闭loading效果。

方法：`wx.stopPullDownRefresh();`

可以自动关闭下拉刷新效果



## 上拉触底

上拉触底也是移动端的专有名词，通过手指在屏幕上的上拉滑动操作，从而**加载更多数据**的行为。

常常要配合**节流**一起使用

### 上拉触底小问题！

由于上拉触底，这个操作可以多次的触发(就是不断滑动到底部)，当我们在请求数据时，只需要请求一次就行，所以说需要给事件添加**节流**，来控制请求在一段时间内只能触发一次

方式一：

1. 在data定义`isLoading`节流阀
2. 在`getData()`接口中修改`isLoading`节流阀的值
3. 在`onReachBottom`中判断节流阀的值，从而对数据请求进行节流控制



具体操作：

```js
data: {
  // 设置一个节流阀，false表示没有数据请求，true表示还在数据请求
  isLoading: false
},
  
getData() {
  // 发起请求前，修改节流阀
  this.setData({
    isLoading: true
  })
  wx.request({
    url:xxx,
    complete: () => {
      // 请求完毕，修改节流阀
      this.setData({
        isLoading: false
      })
    }
  })
},
/**
 * 页面上拉触底事件的处理函数
 */
onReachBottom: function () {
  // 根据节流阀判断是否还要发起请求
  if(!this.data.isLoading) this.getColors();
},
```







### 监听页面的上拉触底事件

在页面的`.js`文件中，通过`onReachBottom()`函数来监听上拉触底的事件。



### 控制上拉触底的距离

可以在全局，或者页面的`.json`中进行配置，通过`"onReachBottomDistance"`配置项进行配置

示例：

```js
// 触底距离为100px
"onReachBottomDistance": 100
// 注意单位默认就是px，直接写数字
```

